<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>deep-roles.js - deepjs Javascript Framework</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="deepjs Javascript Framework"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.rc</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/deep.html">deep</a></li>
            
                <li><a href="../classes/deep.Chain.html">deep.Chain</a></li>
            
                <li><a href="../classes/deep.collider.html">deep.collider</a></li>
            
                <li><a href="../classes/deep.collider.array.html">deep.collider.array</a></li>
            
                <li><a href="../classes/deep.collider.assert.html">deep.collider.assert</a></li>
            
                <li><a href="../classes/deep.collider.object.html">deep.collider.object</a></li>
            
                <li><a href="../classes/deep.compose.html">deep.compose</a></li>
            
                <li><a href="../classes/deep.Composer.html">deep.Composer</a></li>
            
                <li><a href="../classes/deep.deep.html">deep.deep</a></li>
            
                <li><a href="../classes/deep.Deferred.html">deep.Deferred</a></li>
            
                <li><a href="../classes/deep.Promise.html">deep.Promise</a></li>
            
                <li><a href="../classes/deep.Query.html">deep.Query</a></li>
            
                <li><a href="../classes/deep.Role.html">deep.Role</a></li>
            
                <li><a href="../classes/deep.roles.html">deep.roles</a></li>
            
                <li><a href="../classes/deep.store.html">deep.store</a></li>
            
                <li><a href="../classes/deep.store.Array.html">deep.store.Array</a></li>
            
                <li><a href="../classes/deep.store.Object.html">deep.store.Object</a></li>
            
                <li><a href="../classes/deep.Store.html">deep.Store</a></li>
            
                <li><a href="../classes/deep.stores.html">deep.stores</a></li>
            
                <li><a href="../classes/deep.stores.aspect.html">deep.stores.aspect</a></li>
            
                <li><a href="../classes/deep.stores.instance.html">deep.stores.instance</a></li>
            
                <li><a href="../classes/deep.stores.js.html">deep.stores.js</a></li>
            
                <li><a href="../classes/deep.stores.queryThis.html">deep.stores.queryThis</a></li>
            
                <li><a href="../classes/deep.utils.html">deep.utils</a></li>
            
                <li><a href="../classes/deep.Validator.html">deep.Validator</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/deep.html">deep</a></li>
            
                <li><a href="../modules/deep-collider.html">deep-collider</a></li>
            
                <li><a href="../modules/deep-compose.html">deep-compose</a></li>
            
                <li><a href="../modules/deep-query.html">deep-query</a></li>
            
                <li><a href="../modules/deep-roles.html">deep-roles</a></li>
            
                <li><a href="../modules/deep-rql.html">deep-rql</a></li>
            
                <li><a href="../modules/deep-schema.html">deep-schema</a></li>
            
                <li><a href="../modules/deep-stores.html">deep-stores</a></li>
            
                <li><a href="../modules/utils.html">utils</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: deep-roles.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 *
 *
 *  
 * @module deep
 * @submodule deep-roles
 * @author Gilles Coomans &lt;gilles.coomans@gmail.com&gt;
 */
if(typeof define !== &#x27;function&#x27;)
	var define = require(&#x27;amdefine&#x27;)(module);

define([&quot;require&quot;, &quot;deep/deep&quot;],function(require)
{
	return function(deep){

		/**
		 * Just a namespace : where default and custom roles are mainly stored. 
		 * @class deep.roles
		 * @static
		 * @type {Object}
		 */
		deep.roles = {

		}

		/**
		 * @class Role
		 * @namespace deep
		 * @constructor
		 */
		deep.Role = {
			/**
			 * @property _deep_role
			 * @private
			 * @type {Boolean}
			 */
			_deep_role_:true,
			name:null,
			initialised:false,
			/**
			 * just the place where stores are stored in this role
			 * @type {Object}
			 */
			stores:{

			},
			/**
			 * initialise the role. will forward init on stores.
			 * @return {deep.Chain}  the chain that perform the init (to wait for)
			 */
			init:function () {
				this.initialised = true;
				return deep(this)
				.query(&quot;./stores/*&quot;)
				.run(&quot;init&quot;);
			}
		}

		/**
		 * a way to start a chain setted with a certain role
		 * @param  {String} name the name of the roel to select
		 * @return {deep.Chain} the chain setted with the role
		 */
		deep.role = function (name) {
			return deep(null).role(name);
		}

		/**
		 * select a role for any subsequent call for this chain (also inner call : see tutorials)
		 * @for deep.Chain
		 * @method role
		 * @param  {String} name the role name
		 * @return {deep.Chain} the chain hanlder with role setted in context. 
		 */
		deep.Chain.prototype.role = function () 
		{
			var self = this;
			var roles = Array.prototype.slice.apply(arguments);
			var joined = roles.join(&quot;.&quot;);

			var finalise = function (role,s,e) {
				var context = deep.context = deep.utils.simpleCopy(self.context);
				self.context = context;
				self.context.role = role;
				if(self._store)
					self._store = deep.store(self._store.name);
				return [s,e];
			}

			deep._roles = deep._roles || {};

			var func = function (s,e) 
			{
				try{
					var ctrl = deep._roles[joined];
					if(!ctrl)
					{
						if(console.flags[&quot;autobahn-roles-cache&quot;])
							console.log(&quot;roles (&quot;,roles,&quot;) wasn&#x27;t in cache : create it&quot;);
						var ctrl = {};
						roles.forEach(function(e){
							//console.log(&quot;applying role : &quot;, e)
							if(deep.roles[e])
								deep.utils.up(deep.roles[e], ctrl);
							else
								throw new Error(&quot;error while compiling roles : no role founded with : &quot;+e);
						});
						deep._roles[joined] = ctrl;
						ctrl.name = joined;
					}
				}
				catch(e){
					if(e instanceof Error)
						throw e;
					throw new Error(&quot;error while compiling roles : &quot;+String(e));
				}

				if(!ctrl.initialised)
				{
					//console.log(&quot;CONTROLLER NOT LOADED : load it : &quot;, ctrl)
					return deep(deep)
					.catchError()
					.query(&quot;./_roles/&quot;+joined)
					.bottom(deep.Role)
					.flatten()
					.run(&quot;init&quot;)
					.log(&quot;role &quot;+joined+&quot; : initalised...&quot;)
					.done(function (success) {
						return finalise(ctrl,s,e);
					});
				}
				else
					return finalise(ctrl,s,e);
			}
			//deep.handlers.decorations.role(role, self);
			deep.chain.addInChain.apply(this,[func]);
 			return self;
		}

/*
		deep.store(&quot;role&quot;, {
			_deep_store_:true,
			get:function (id, options) {
				return deep(null).role(id);
			}
		});
*/
		//_________ TESTS
		deep(deep.roles).up({
			&quot;public&quot;:{
				name:&quot;public&quot;,
				backgrounds:[deep.Role],
				stores:deep.stores
			}
		})
		.flatten();

		return deep;
	}
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
