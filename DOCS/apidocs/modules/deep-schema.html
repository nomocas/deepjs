<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>deep-schema - deepjs Javascript Framework</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="deepjs Javascript Framework"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.rc</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/deep.html">deep</a></li>
            
                <li><a href="../classes/deep.Chain.html">deep.Chain</a></li>
            
                <li><a href="../classes/deep.collider.html">deep.collider</a></li>
            
                <li><a href="../classes/deep.collider.array.html">deep.collider.array</a></li>
            
                <li><a href="../classes/deep.collider.assert.html">deep.collider.assert</a></li>
            
                <li><a href="../classes/deep.collider.object.html">deep.collider.object</a></li>
            
                <li><a href="../classes/deep.compose.html">deep.compose</a></li>
            
                <li><a href="../classes/deep.Composer.html">deep.Composer</a></li>
            
                <li><a href="../classes/deep.deep.html">deep.deep</a></li>
            
                <li><a href="../classes/deep.Deferred.html">deep.Deferred</a></li>
            
                <li><a href="../classes/deep.Promise.html">deep.Promise</a></li>
            
                <li><a href="../classes/deep.Query.html">deep.Query</a></li>
            
                <li><a href="../classes/deep.Role.html">deep.Role</a></li>
            
                <li><a href="../classes/deep.roles.html">deep.roles</a></li>
            
                <li><a href="../classes/deep.store.html">deep.store</a></li>
            
                <li><a href="../classes/deep.store.Array.html">deep.store.Array</a></li>
            
                <li><a href="../classes/deep.store.Object.html">deep.store.Object</a></li>
            
                <li><a href="../classes/deep.Store.html">deep.Store</a></li>
            
                <li><a href="../classes/deep.stores.html">deep.stores</a></li>
            
                <li><a href="../classes/deep.stores.aspect.html">deep.stores.aspect</a></li>
            
                <li><a href="../classes/deep.stores.instance.html">deep.stores.instance</a></li>
            
                <li><a href="../classes/deep.stores.js.html">deep.stores.js</a></li>
            
                <li><a href="../classes/deep.stores.queryThis.html">deep.stores.queryThis</a></li>
            
                <li><a href="../classes/deep.utils.html">deep.utils</a></li>
            
                <li><a href="../classes/deep.Validator.html">deep.Validator</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/deep.html">deep</a></li>
            
                <li><a href="../modules/deep-collider.html">deep-collider</a></li>
            
                <li><a href="../modules/deep-compose.html">deep-compose</a></li>
            
                <li><a href="../modules/deep-query.html">deep-query</a></li>
            
                <li><a href="../modules/deep-roles.html">deep-roles</a></li>
            
                <li><a href="../modules/deep-rql.html">deep-rql</a></li>
            
                <li><a href="../modules/deep-schema.html">deep-schema</a></li>
            
                <li><a href="../modules/deep-stores.html">deep-stores</a></li>
            
                <li><a href="../modules/utils.html">utils</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1>deep-schema Module</h1>
<div class="box clearfix meta">
    

    

    
        <div class="foundat">
            Defined in: <a href="../files/deep-schema.js.html#l321"><code>deep-schema.js:321</code></a>
        </div>
    

    
</div>



<div class="box intro">
    <p>JSON-Schema validator : based on json-schema draft 02, 03, and 04 + extensions
     http://tools.ietf.org/html/draft-zyp-json-schema-03</p>
</div>


    <div class="example">
        <h4>Example:</h4>
        <div class="example-content">
            <pre class="code prettyprint"><code>Ajout par rapport à la v3


type:
    schema
    false
    true
    function
    date
    hash     !!!!!     différent de object ou array == TROISIEME TYPE non simple : hash table d'items

notNull

absoluteMinimum
absoluteMaximum

merge
loadable
"interpretation-deepness"   ==&gt; have equivalent in draft 4 : template : bad word : template-engine is better or href-interpreter (because it's the only interpretable string)


deprecated : 
$ref : to be removed : incoherent with backgrounds


semantic misuse :
id has to became uri


v3 / V4
pattern remplace format ?
divisibleBy -&gt; mod
max/minProperties

required : fuzzy concept now : need 
dependencies : always fuzzy : need example to be clear

I propose : 

{
    myConstraintProperty:{
        required:Boolean,   // means that's, in any case, this property is needed
        require:{
            // is the schema that the whole object (from root) need to satisfy
            path:{
                to:{
                    requiredProperty:{
                        // schema that requiredProperty need to satisfy
                    }
                }
            }
        }
    }
}

Fuzzy : format/pattern/value :    value is more clear : 
I propose : 
    when object.value is a leaf of the object instance (no array, nor object):
    if(schema.value is RegExp)
        object.value must match schema.value (equivalent of pattern)
    else
        object.value must be equal to schema.value

that permit to be a mecanisme for true or false constraint value (no more "true" or "false" type)
that also permit to be a constraint on the object.value for any dependencies :

so : 
taxerate:{
    required:true,
    dependencies:[
        { 
            constraint:{
                // the schema that need to be matched on the dependant value
                pattern:"tva-pattern-uk"
            }, 
            instance:{
                // the schemas that pointed properties (from root) need to satisfy to evaluate 
                path:{
                    to:{
                        country:{
                            pattern:"UK"
                        }
                    }
                }
            }
        },
        { 
            constraint:{
                // the schema that need to be matched on the dependant value
                pattern:"tva-pattern-eu"
            }, 
            instance:{
                // the schema that pointed properties (from root) need to satisfy to evaluate 
                properties:{
                    pathTo:{
                        properties:{
                            country:{
                                enum:["SE","FR","ES"]
                            }
                        }
                    }
                }
            }
        }
    ]
}


With json-pointer :
taxerate:{
    required:true,
    dependencies:[
        { 
            constraint:{  // the schema that need to be matched on the dependant value. Optional : empty schema by default
                pattern:"tva-pattern-uk"
            }, 
            test:{
                // the schemas that pointed property (from root - in object instance) need to be satisfied to evaluate constraint above
                "#/address/country":{
                    pattern:"UK"
                }
            }
        },
        { 
            constraint:{
                // the schema that need to be matched on the dependant value
                pattern:"tva-pattern-eu"
            }, 
            test:{
                // the schema that whole object (from root) needs to be satisfied to evaluate constraint above
                "#/address/country":{ 
                    enum:["FR", "ES"]
                }
            }
        }
    ]
}

the order of evaluation is done up-bottom, and the first dependecy that match the test will test his constraint on the value.
Only the first is interpreted.

if there is 


Donc : SI l'instance satisfait tels schema : ALORS la valeur dépendante doit satisfaire tels contraintes

manque mécanisme de référence interne : 

genre : 

mySchema:{
    obj:{
        obj2:{
            "$ref": "/"
        }
    }
}

==&gt; utiliser backgrounds + json-pointer

{
    properties:{
        myNestedChilds:{
            patternProperties:{
                /.* /g:{
                    backgrounds:["#/"],   // TOdo faire attention dans l'backgrounds d'un ancêtre : cycle possible : faut que l'extension ne cycle pas mais que la structure soit bien nesté à l'infini : solution faire l'backgrounds le plus tard possible : ne pas extender toute la structure dés le début
                    properties:{ 
                        parent:{ type:"any" } 
                    } 
                }
            }

        }
    }
}

sinon : addionnal items n'a de sens que si items est une array.



REFACTORING EXTENDS
backgrounds dans deep-schema : faire un mix : 
précompilation du schéma : dés qu'on voit qu'on doit choper un ancetre pour un backgrounds (dans le schema) : on laisse l'backgrounds  (on remplace dans l'array backgrounds tout ce qui peut etre compilé par sa compilation (par groupe en laissant l'ordre et les référence vers anc^etres tel quel - tout ce qui est en dessous de la première référence à un parent peut déjà être appliqué))
lorsqu'on a une instance : lors du parsing/compilation (au deep-copy par exemple, lorsqu'on voit passer tous les champs) : 
    on chope le schema associé à la propriété courante
        si backgrounds encore présent dans schema : copier ancetre dans vide, (sans backgrounds), coller schema prop courante dessus (sans backgrounds) : retourner le tout

si backgrounds vers ancetres dans instance : throw : error : cycle present ! structure infinie



backgrounds et foregrounds : 
    ne pas les mettre dans l'instance : ca devient difficile à gérer : les mettre dans le schema : la c'est cohérent

     au final : comme un schema chope de plus en plus de propriétés d'un deep-factory : il faudrait que le schema soit un deep-factory 
     dont son propre schema soit le meta schema du schema
</code></pre>
        </div>
    </div>


<div class="yui3-g">
    <div class="yui3-u-1-2">
        
            <p>This module provides the following classes:</p>

            <ul class="module-classes">
            
                <li class="module-class">
                    <a href="../classes/deep.Validator.html">
                        deep.Validator
                    </a>
                </li>
            
            </ul>
        
    </div>

    <div class="yui3-u-1-2">
        
    </div>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
